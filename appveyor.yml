before_build:
  - cmd: dotnet --version
  - ps:  Get-ChildItem -Path "C:\Program Files\dotnet\sdk"
  - ps: scripts\patch_versions.ps1

install:  
  # Download .NET Core 2.0 Preview 2 SDK and add to PATH
  - ps: $urlCurrent = "https://download.microsoft.com/download/1/B/4/1B4DE605-8378-47A5-B01B-2C79D6C55519/dotnet-sdk-2.0.0-win-x64.zip"
  - ps: $env:DOTNET_INSTALL_DIR = "$pwd\.dotnetsdk"
  - ps: mkdir $env:DOTNET_INSTALL_DIR -Force | Out-Null
  - ps: $tempFileCurrent = [System.IO.Path]::GetTempFileName()
  - ps: (New-Object System.Net.WebClient).DownloadFile($urlCurrent, $tempFileCurrent)
  - ps: Add-Type -AssemblyName System.IO.Compression.FileSystem; [System.IO.Compression.ZipFile]::ExtractToDirectory($tempFileCurrent, $env:DOTNET_INSTALL_DIR)
  - ps: $env:Path = "$env:DOTNET_INSTALL_DIR;$env:Path"

branches:
  only:
    - master
    - dev

build_script:
  - ps: scripts\build.ps1

test_script:
  - cmd: echo Tests already ran

artifacts:
  - path: src\Armyknife\bin\release\netcoreapp1.1\win10-x64\publish
    name: armyknife-windows
    type: zip

deploy:
  release: $(versionString)
  provider: GitHub
  auth_token:
    secure: Zcoti9GsS4Y1t12qVcWhfDXMJLW8QLt4SdeQi8VKUFBtd/gVyWsZlLXDOHLP8i5U
  artifact: /.*\.zip/
  draft: true
  on:
    branch: master